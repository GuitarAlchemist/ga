@* Chord diagram visualization component *@

<div class="chord-diagram-container">
    <div class="chord-diagram" title="@ChordName">
        <div class="chord-name">@ChordName</div>

        @if (Voicing != null && Voicing.Length == 6)
        {
            <svg width="140" height="180" viewBox="0 0 140 180" class="chord-svg">
                <!-- Nut (if starting at fret 0) -->
                @if (StartFret == 0)
                {
                    <rect x="18" y="28" width="104" height="4" fill="#333"/>
                }
                else
                {
                    @(new MarkupString($"<text x=\"10\" y=\"55\" font-size=\"12\" fill=\"#666\">{StartFret}fr</text>"))
                }

                <!-- Frets -->
                @for (var fret = 0; fret < 5; fret++)
                {
                    var y = 30 + fret * 30;
                    var strokeWidth = fret == 0 && StartFret == 0 ? 3 : 1;
                    <line x1="20" y1="@y" x2="120" y2="@y"
                          stroke="#666" stroke-width="@strokeWidth"/>
                }

                <!-- Strings -->
                @for (var str = 0; str < 6; str++)
                {
                    var x = 20 + str * 20;
                    <line x1="@x" y1="30" x2="@x" y2="150"
                          stroke="#888" stroke-width="1.5"/>
                }

                <!-- String labels (E A D G B E) -->
                @{
                    var stringNames = new[] { "E", "A", "D", "G", "B", "E" };
                }
                @for (var str = 0; str < 6; str++)
                {
                    var x = 20 + str * 20;
                    @(new MarkupString($"<text x=\"{x}\" y=\"170\" text-anchor=\"middle\" font-size=\"11\" fill=\"#666\">{stringNames[str]}</text>"))
                }

                <!-- Finger positions and markers -->
                @for (var str = 0; str < 6; str++)
                {
                    var x = 20 + str * 20;
                    var fret = Voicing[str];

                    @if (fret > 0)
                    {
                        // Played note - show dot with finger number
                        var displayFret = fret - StartFret;
                        var y = 30 + displayFret * 30 - 15;

                        <circle cx="@x" cy="@y" r="8"
                                fill="#2196F3" stroke="#fff" stroke-width="2"/>

                        @if (FingerNumbers != null && str < FingerNumbers.Length && FingerNumbers[str] > 0)
                        {
                            @(new MarkupString($"<text x=\"{x}\" y=\"{y + 4}\" text-anchor=\"middle\" font-size=\"11\" font-weight=\"bold\" fill=\"#fff\">{FingerNumbers[str]}</text>"))
                        }
                    }
                    else if (fret == 0)
                    {
                        // Open string - circle above nut
                        <circle cx="@x" cy="18" r="6" fill="none"
                                stroke="#4CAF50" stroke-width="2"/>
                    }
                    else
                    {
                        // Muted string - X above nut
                        @(new MarkupString($"<text x=\"{x}\" y=\"22\" text-anchor=\"middle\" font-size=\"16\" font-weight=\"bold\" fill=\"#f44336\">×</text>"))
                    }
                }

                <!-- Barre indicator if needed -->
                @if (BarreInfo != null)
                {
                    var y = 30 + (BarreInfo.Fret - StartFret) * 30 - 15;
                    var x1 = 20 + BarreInfo.FromString * 20;
                    var x2 = 20 + BarreInfo.ToStringNum * 20;

                    <line x1="@x1" y1="@y" x2="@x2" y2="@y"
                          stroke="#2196F3" stroke-width="16" stroke-linecap="round" opacity="0.8"/>
                }
            </svg>

            @if (!string.IsNullOrEmpty(Notes))
            {
                <div class="chord-notes">
                    <small>@Notes</small>
                </div>
            }
        }
        else
        {
            <div class="chord-error">
                <small>Invalid voicing data</small>
            </div>
        }
    </div>
</div>

@code {

    /// <summary>
    ///     The name of the chord (e.g., "Cmaj7", "Dm7")
    /// </summary>
    [Parameter]
    public string ChordName { get; set; } = "";

    /// <summary>
    ///     Array of 6 integers representing fret positions for each string (low E to high E)
    ///     -1 = muted, 0 = open, 1+ = fret number
    /// </summary>
    [Parameter]
    public int[]? Voicing { get; set; }

    /// <summary>
    ///     Optional finger numbers for each string (1-4, 0 = no finger)
    /// </summary>
    [Parameter]
    public int[]? FingerNumbers { get; set; }

    /// <summary>
    ///     Starting fret number (default 0 for open position)
    /// </summary>
    [Parameter]
    public int StartFret { get; set; }

    /// <summary>
    ///     Optional notes in the chord (e.g., "C E G B")
    /// </summary>
    [Parameter]
    public string? Notes { get; set; }

    /// <summary>
    ///     Optional barre information
    /// </summary>
    [Parameter]
    public BarreInfo? BarreInfo { get; set; }

}

///
<summary>
    /// Information about a barre chord
    ///
</summary>
public record BarreInfo(int Fret, int FromString, int ToString);

